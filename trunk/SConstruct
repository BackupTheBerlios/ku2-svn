#
#	SConstruct file for Kane Utilities 2
#
#	Fri Apr  7 17:16:57 2006
#		J. Anton, Copyright 2006
#

env = Environment(CPPPATH=".", CCFLAGS="-Wall")

conf = Configure(env)
if not conf.CheckCHeader("ctype.h"):
	sys.exit()	
if not conf.CheckCHeader("dirent.h"):
	sys.exit()
if not conf.CheckCHeader("errno.h"):
	sys.exit()
if not conf.CheckCHeader("libintl.h"):
	env.Append(CPPDEFINES = ["NO_GETTEXT"])
if not conf.CheckCHeader("stdarg.h"):
	sys.exit()
if not conf.CheckCHeader("stdint.h"):
	sys.exit()
if not conf.CheckCHeader("stdio.h"):
	sys.exit()
if not conf.CheckCHeader("stdlib.h"):
	sys.exit()
if not conf.CheckCHeader("string.h"):
	sys.exit()
if not conf.CheckCHeader("time.h"):
	sys.exit()
env = conf.Finish()

mode = ARGUMENTS.get("mode", "debug")
if mode == "debug":
	env.Append(CCFLAGS = " -g", CPPDEFINES = ["DEBUG"])
	debug = ARGUMENTS.get("debug", "memory,func,log")
	if "memory" in debug:
		env.Append(CPPDEFINES = ["DEBUG_MEMORY"])
	if "func" in debug:
		env.Append(CPPDEFINES = ["DEBUG_FUNC"])
	if "log" in debug:
		env.Append(CPPDEFINES = ["DEBUG_LOG"])
elif mode == "release":
	env.Append(CCFLAGS = " -O3 -march=pentium4")
	env.Append(LINKFLAGS = " -s")
	debug = ""
else:
	print "Invalid mode ( debug|release )"
	Exit()

use = ARGUMENTS.get("use", "gettext")
if "gettext" in use:
	env.Append(CPPDEFINES = ["USE_GETTEXT"])

sources = Split("""
	ku2/ku2.c
	log/log.c
	other/other.c
	list/dl_list.c
	abtree/abtree.c
	cfgreader/cfg.c
	""")
#	dialogue/dialogue.c
#	cfgreader/tree_cfg.c
#	resmanager/res.c
#	resmanager/tree_name_res.c
#	resmanager/tree_id_res.c
#	""")

ku2lib = env.Library("ku2", sources)

Default(ku2lib)
